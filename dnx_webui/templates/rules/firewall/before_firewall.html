<script>
async function commitRules(table_id) {
    let FWsection = document.getElementById("section").value;
    let FWrules = tableToJson(table_id);

    let success = await post("commit", {"section": `${FWsection}`, "rules": `${FWrules}`});
    if (success) {
        document.querySelector("#revert").disabled = false;
        document.querySelector("#push").disabled = false;
    }
}
async function pushRules() {
    let success = await post("push", {});
    if (success) {
        document.querySelector("#revert").disabled = true;
        document.querySelector("#push").disabled = true;
    }
}
async function post(endpoint, data) {
        let response = await ajaxClient.post(`/${endpoint}`, data);

        let Response = document.querySelector("#ajax-error-modal");
        Response.querySelector("h5").innerText = response.message;

        let errorModal = M.Modal.init(
            Response, {
                dismissible: false
            }
        );
        errorModal.open();

        return response.status;
}
function tableToJson(table_id) {
    const table = document.getElementById(`${table_id}`)
    let data = {};

    for (let i=0; i<table.rows.length; i++) {

        let tableRow = table.rows[i];
        let rowData = [tableRow.attributes["data-enabled"].value];

        for (let j=2; j<tableRow.cells.length; j++) {
            let currentCell = tableRow.cells[j];

            // converting the fw object list to the proper server format
            if (currentCell.children.length > 0) {
                let objectStr = ""
                for (let obj of tableRow.cells[j].children) {
                    objectStr += `${obj.innerText.replace(" ", "/")},`;
                }
                // pulling out the trailing comma
                rowData.push((objectStr.slice(0, -1)));
            } else {
                rowData.push((currentCell.innerText));
            }
        }
        data[i] = rowData;
    }
    return JSON.stringify(data);
}
</script>

