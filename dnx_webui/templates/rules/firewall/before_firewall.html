<script>
async function commitRules(table_id) {
        let FWsection = document.getElementById("section").value
        let FWrules = tableToJson(table_id)
        let response = await ajaxClient.post("/commit", { "section": `${FWsection}`, "rules": `${FWrules}` });

        if (response.error) {
            let commitError = document.querySelector("#ajax-error-modal");
            commitError.querySelector("h5").innerText = response.message;

            let errorModal = M.Modal.init(
                commitError, {
                    dismissible: false
                }
            );
            errorModal.open();

            console.log("[server/response]: ", response);
        } else {
            console.log("[server/response]: successful commit.")
        }
}
function tableToJson(table_id) {
    const table = document.getElementById(`${table_id}`)
    console.log(table)
    let data = {};

    for (let i=0; i<table.rows.length; i++) {

        let tableRow = table.rows[i];
        let rowData = [tableRow.attributes["data-enabled"].value];

        for (let j=2; j<tableRow.cells.length; j++) {
            rowData.push((tableRow.cells[j].innerText)); // .replace(" ", ",") replace only does first occurrence
        }

        data[i] = rowData;
    }

    return JSON.stringify(data);
}
</script>

